<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dungeon World Chat - Sector 404</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        /* Base Styles & Mobile-First Design */
        body {
            background-color: #050505;
            color: #f0f0f0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            padding: 10px;
            max-width: 850px;
            margin: auto;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
            transition: background-color 0.5s ease;
            padding-top: 50px; /* Space for ticker */
        }

        /* Achievement Box & Glitch Effect */
        .system-ai {
            background: linear-gradient(180deg, #990000 0%, #300000 100%);
            border: 4px solid #ff4500;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 0 30px #ff4500;
            transition: all 0.5s ease;
        }

        .glitch { animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        .header {
            color: #ffcc00;
            font-weight: bold;
            font-size: 1.8em;
            text-transform: uppercase;
            text-shadow: 2px 2px #000;
            line-height: 1.1;
            cursor: pointer;
            user-select: none;
            font-family: 'Share Tech Mono', monospace;
            transition: color 0.5s ease;
        }

        /* Crawler ID Style - Updated for prominence */
        .crawler-id-text {
            font-family: 'Share Tech Mono', monospace;
            color: #ffcc00;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            letter-spacing: 1px;
            text-transform: uppercase;
            border-bottom: 1px solid rgba(255, 69, 0, 0.5);
            padding-bottom: 10px;
            transition: color 0.5s ease, border-color 0.5s ease;
        }

        /* Rarity Classes */
        .rarity-common { border-color: #888; box-shadow: 0 0 15px #888; }
        .rarity-legendary { border-color: #ff8c00; box-shadow: 0 0 25px #ff8c00; }
        .rarity-celestial { border-color: #00ffff; box-shadow: 0 0 30px #00ffff; }

        .achievement {
            color: #fff;
            font-size: 1.5em;
            font-weight: bold;
            margin: 10px 0;
            border-bottom: 2px solid #ff4500;
            padding-bottom: 5px;
            font-family: 'Share Tech Mono', monospace;
            transition: border-color 0.5s ease;
        }
        .ai-snark { color: #ffa500; font-style: italic; font-weight: bold; font-size: 1.1em; line-height: 1.4; }

        /* Chat UI */
        .chat-window { border: 2px solid #444; background: rgba(20, 20, 20, 0.95); padding: 12px; min-height: 400px; transition: all 0.5s ease; }
        .chat-entry { margin-bottom: 10px; padding: 15px; border-radius: 6px; font-size: 1em; line-height: 1.5; opacity: 0; }

        /* Animation for Chat Entries */
        .fade-in {
            animation: fadeInUp 0.5s ease forwards;
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Character Colors */
        .donut { border-left: 6px solid #ff69b4; background: #2b121e; }
        .mordecai { border-left: 6px solid #00d4ff; background: #121c2b; }
        .quasar { border-left: 6px solid #ffcc00; background: #2b2512; }
        .casandra { border-left: 6px solid #00ff00; background: #122b1a; }
        .prepotente { border-left: 6px solid #fdfd96; background: #2b2b12; }
        .katia { border-left: 6px solid #00ffff; background: #122b2b; }
        .odette { border-left: 6px solid #9932cc; background: #2b122b; } 
        .elle { border-left: 6px solid #98fb98; background: #122b1b; } 
        .florin { border-left: 6px solid #daa520; background: #2b2212; } 
        .zev { border-left: 6px solid #ff1493; background: #2b121c; }

        .username { font-weight: bold; display: block; margin-bottom: 5px; text-transform: uppercase; font-size: 0.9em; font-family: 'Share Tech Mono', monospace; letter-spacing: 0.5px; }
        .donut .username { color: #ff69b4; }
        .mordecai .username { color: #00d4ff; }
        .quasar .username { color: #ffcc00; }
        .casandra .username { color: #00ff00; }
        .prepotente .username { color: #fdfd96; }
        .katia .username { color: #00ffff; }
        .odette .username { color: #9932cc; }
        .elle .username { color: #98fb98; }
        .florin .username { color: #daa520; }
        .zev .username { color: #ff1493; }

        /* Floor Status */
        .floor-status { margin-top: 25px; padding: 15px; border-left: 6px solid #ffcc00; background: #221e00; font-size: 1em; transition: all 0.5s ease; }
        .status-header { color: #ffcc00; font-weight: bold; display: block; margin-bottom: 10px; text-transform: uppercase; font-family: 'Share Tech Mono', monospace; font-size: 1.2em; }
        .status-list { list-style: none; padding: 0; margin: 0; }
        .status-list li { margin-bottom: 8px; font-family: 'Share Tech Mono', monospace; }

        /* Footer & Buttons */
        .node-footer { margin-top: 40px; border: 2px solid #00ff00; padding: 20px; text-align: center; background: #000; transition: border-color 0.5s ease; }
        .button {
            display: block; width: 100%; box-sizing: border-box; margin-top: 15px; padding: 18px;
            background-color: #00ff00; color: #000; font-weight: bold; text-decoration: none;
            text-transform: uppercase; font-size: 1.2em; border-radius: 4px; border: none; cursor: pointer;
            transition: all 0.5s ease;
            font-family: 'Share Tech Mono', monospace;
        }
        .button:active { opacity: 0.7; }
        .button:disabled { background-color: #333; color: #666; cursor: not-allowed; }

        /* Share Options Styles */
        #share-options { display: none; margin-top: 15px; }
        .share-grid { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
        .share-btn { margin: 0 !important; flex: 1; min-width: 80px; padding: 12px !important; font-size: 0.9em !important; color: white !important; }

        /* Blinking Cursor for Voodoo Header */
        .blinking-cursor::after {
            content: '_';
            animation: blink 1s step-end infinite;
        }
        @keyframes blink { 50% { opacity: 0; } }

        /* NFC Hint Style */
        .nfc-hint {
            margin-top: 20px;
            padding: 12px;
            border: 2px solid #ffcc00;
            background: #221a00;
            color: #ffcc00;
            font-weight: bold;
            text-align: center;
            font-size: 0.9em;
            animation: pulse-warning 2s infinite;
            font-family: 'Share Tech Mono', monospace;
        }
        @keyframes pulse-warning { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }

        /* Ticker Styles */
        .ticker-wrap {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: #111;
            border-bottom: 2px solid #ff4500;
            overflow: hidden;
            height: 35px;
            line-height: 35px;
            z-index: 990; /* Below toggle buttons */
            transition: border-color 0.5s ease;
        }

        .ticker {
            display: inline-block;
            white-space: nowrap;
            padding-left: 100%;
            animation: ticker 900s linear infinite; 
            color: #ffcc00;
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.9em;
        }

        @keyframes ticker {
            0% { transform: translate3d(0, 0, 0); }
            100% { transform: translate3d(-100%, 0, 0); }
        }

        /* Easter Egg Overlay */
        #easter-egg-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            color: #ff0000;
            font-family: 'Share Tech Mono', monospace;
            border: 5px solid #ff0000;
            box-sizing: border-box;
        }

        /* --- DONUT MODE STYLES --- */
        body.donut-theme {
            background-color: #1a0515;
            color: #ffccff;
        }

        body.donut-theme .system-ai {
            background: linear-gradient(180deg, #660033 0%, #33001a 100%);
            border-color: #ff69b4;
            box-shadow: 0 0 30px #ff69b4;
        }

        body.donut-theme .header {
            color: #ff69b4;
            text-shadow: 2px 2px #330033;
        }

        body.donut-theme .crawler-id-text {
            color: #ff99cc;
            border-bottom-color: #ff1493;
        }

        body.donut-theme .achievement {
            border-bottom-color: #ff69b4;
        }

        body.donut-theme .ai-snark {
            color: #ff99cc;
        }

        body.donut-theme .chat-window {
            border-color: #ff69b4;
            background: rgba(40, 10, 30, 0.95);
        }

        /* Override "Live System Chat" inline colors */
        body.donut-theme .username[style*="#00ff00"] {
            color: #ff69b4 !important;
        }

        /* Override Floor Status */
        body.donut-theme .floor-status {
            border-left-color: #ff69b4 !important; 
            background: #2b0015 !important;
        }

        body.donut-theme .status-header {
            color: #ff69b4 !important;
        }
        
        body.donut-theme #level-timer {
            color: #ff1493 !important;
        }

        body.donut-theme .nfc-hint {
            border-color: #ff69b4;
            background: #2a0e2a;
            color: #ff69b4;
        }

        /* Override Footer & Buttons */
        body.donut-theme .node-footer {
            border-color: #ff69b4;
        }

        body.donut-theme .node-footer strong {
            color: #ff69b4 !important;
        }

        body.donut-theme .button {
            background-color: #ff69b4 !important;
            color: #000000 !important; /* Changed to Black for readability */
        }

        /* Override Panic Meter in Donut Mode */
        body.donut-theme #panic-bar {
            border-color: #ff69b4 !important;
        }
        body.donut-theme #panic-text {
            color: #ff69b4 !important;
        }
        body.donut-theme #gen-container {
             background: #2b0015 !important;
             border-color: #ff69b4 !important;
             border-style: dashed;
        }

        /* Override Voodoo Board in Donut Mode */
        body.donut-theme #voodoo-board-container {
             border-color: #ff69b4 !important;
        }
        body.donut-theme #voodoo-header {
             color: #ff69b4 !important;
        }
        body.donut-theme #voodoo-board-container button {
             border-color: #ff69b4 !important;
             color: #000000 !important; /* Black text for buttons */
             background-color: #ff69b4 !important;
        }
        body.donut-theme #voodoo-board-container input,
        body.donut-theme #voodoo-board-container textarea {
             border-color: #ff69b4 !important;
             color: #ff69b4 !important;
        }
        body.donut-theme #voodoo-feed {
            border-color: #ff69b4 !important;
            color: #ffccff !important;
        }
        body.donut-theme #voodoo-feed span[style*="#ffcc00"] {
            color: #ff69b4 !important;
        }
        body.donut-theme #char-count {
            color: #ff69b4 !important;
        }

        /* Override Ticker in Donut Mode */
        body.donut-theme .ticker-wrap {
            border-bottom-color: #ff69b4;
            background: #2a0e2a;
        }
        body.donut-theme .ticker {
            color: #ffccff;
        }

        @media (min-width: 600px) {
            body { padding: 30px; padding-top: 60px; }
            .header { font-size: 2.2em; }
            .achievement { font-size: 1.8em; }
            .button { width: auto; display: inline-block; padding: 15px 40px; }
        }
    </style>
</head>
<body>
    
    <!-- System Ticker -->
    <div class="ticker-wrap">
        <div class="ticker" id="system-ticker"></div>
    </div>

    <!-- Theme Toggle -->
    <button id="theme-toggle" onclick="window.toggleDonutMode()" title="Toggle Donut Mode" style="position: fixed; top: 45px; right: 15px; z-index: 999; font-size: 2em; background: none; border: none; cursor: pointer; filter: drop-shadow(0 0 5px #000);">üï∂Ô∏è</button>

    <div id="easter-egg-overlay">
        <h1 style="font-size: 3em; margin-bottom: 10px;">!!! GLITCH DETECTED !!!</h1>
        <p style="font-size: 1.5em; color: #fff;">CARL! YOU'VE UNLOCKED: GOD-TIER CRAWLER STATUS!</p>
        <p style="font-size: 1.2em; font-style: italic; color: #888; margin-top: 20px;">(Nothing actually changed. Mordecai is still disappointed.)</p>
        <button onclick="window.closeEasterEgg()" class="button" style="background: #ff0000; color: #fff; margin-top: 30px;">RESUME SIMULATION</button>
    </div>

    <div class="system-ai">
        <div id="crawler-id" class="crawler-id-text">[ ID: UNKNOWN ]</div>
        <div class="header" onclick="window.trackHeaderTaps()">!!! NEW ACHIEVEMENT !!!</div>
        <div class="achievement" id="main-achievement-title">"CON-FLOOR SURVIVOR"</div>
        <p id="main-achievement-body">YOU DID IT! You‚Äôve successfully navigated the <strong>ATLANTA SKYBRIDGE GAUNTLET</strong>! You have survived the humidity, the smell of burnt rubber and expensive polyester, and the sheer, unadulterated chaos of sixty-thousand humans trying to occupy the same square inch of hotel carpet!</p>
        <p id="main-ai-snark" class="ai-snark">REWARD: You‚Äôve received a [Platinum] Badge Ribbon! It grants you +5 to Crowd Maneuvering and -10 to Personal Space. GET BACK TO THE MESH!</p>
    </div>

    <!-- FULL CHARACTER CHAT (Dynamic) -->
    <div class="chat-window">
        <span class="username" style="color: #00ff00; display: block; margin-bottom: 10px; font-size: 1.2em;" id="live-chat-header">[ LIVE SYSTEM CHAT ]</span>
        <div id="character-feed" aria-live="polite">
            <!-- JS will populate this -->
        </div>
    </div>

    <!-- LIVE STATUS BLOCK -->
    <div class="floor-status">
        <span class="status-header">[ LIVE FLOOR STATUS: SECTOR ATLANTA ]</span>
        <ul class="status-list" aria-live="polite">
            <li>‚è≥ LEVEL COLLAPSE IN: <span id="level-timer" style="color: #ff0000; font-weight: bold; font-family: 'Share Tech Mono', monospace;">CALCULATING...</span></li>
            <li id="status-row-1">üî∏ SCANNING SECTOR...</li>
            <li id="status-row-2">üî∏ SCANNING SECTOR...</li>
            <li id="status-row-3">üî∏ SCANNING SECTOR...</li>
        </ul>
    </div>

    <!-- Prepotente Panic Meter -->
    <div class="floor-status" style="border-left-color: #fdfd96; margin-top: 15px;">
        <span class="status-header" id="panic-header">[ PREPOTENTE PANIC METER ]</span>
        <div id="panic-bar" style="height: 30px; background: #111; border: 2px solid #fdfd96; position: relative; overflow: hidden; margin-top: 10px;">
            <div id="panic-fill" style="height: 100%; background: linear-gradient(90deg, #fdfd96, #ff0000); width: 85%; transition: width 1s;"></div>
        </div>
        <p id="panic-text" style="font-size: 0.9em; margin-top: 8px; color: #fdfd96; font-weight: bold; text-transform: uppercase; font-family: 'Share Tech Mono', monospace;">üêê CURRENT STATUS: AAAAAAHHHHH!</p>
    </div>

    <!-- NFC HINT -->
    <div class="nfc-hint" id="nfc-hint">
        [ SYSTEM WARNING: PROXIMITY SCAN DETECTED. TAP CHIP FOR UNSTABLE DATA UPLOAD ]
    </div>

    <div id="gen-container" class="system-ai" style="margin-top: 30px; border-style: dashed; background: #220000;">
        <div id="custom-header" class="header" style="font-size: 1.4em;">SYSTEM READY...</div>
        <div id="custom-title" class="achievement">"TAP FOR FATE"</div>
        <p id="custom-body" style="font-size: 1em;">Generate a useless achievement based on your level of survival.</p>

        <button onclick="window.generateAchievement()" class="button" style="background-color: #ff4500; color: white;">GENERATE ACHIEVEMENT</button>

        <div id="share-options">
            <p style="font-size: 0.9em; color: #ffcc00; margin-bottom: 10px; font-family: 'Share Tech Mono', monospace;">BRAG TO THE FEED:</p>
            <div class="share-grid">
                <button class="button share-btn" onclick="window.shareX()" style="background: #000;">X</button>
                <button class="button share-btn" onclick="window.shareBlueSky()" style="background: #0085ff;">BlueSky</button>
                <button class="button share-btn" onclick="window.shareThreads()" style="background: #444;">Threads</button>
                <button class="button share-btn" onclick="window.copyToClipboard(event)" style="background: #00ff00; color: #000;">Copy</button>
            </div>
        </div>
    </div>

    <!-- Voodoo Board -->
    <div class="chat-window" style="margin-top: 25px; border-color: #00ff00; margin-bottom: 25px;" id="voodoo-board-container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <span class="username blinking-cursor" style="color: #00ff00; margin: 0; font-size: 1.2em;" id="voodoo-header">[ VOODOO BOARD ]</span>
            <button onclick="window.loadVoodooMessages()" style="background: none; border: 1px solid #00ff00; color: #00ff00; font-size: 0.8em; padding: 4px 10px; cursor: pointer; font-family: 'Share Tech Mono', monospace;">REFRESH</button>
        </div>
        
        <div id="voodoo-feed" style="height: 300px; overflow-y: auto; -webkit-overflow-scrolling: touch; scroll-behavior: smooth; background: #000; padding: 10px; font-family: 'Share Tech Mono', monospace; font-size: 1.1em; border: 1px solid #333; margin-bottom: 15px; color: #00ff00; line-height: 1.5;" aria-live="polite">
            SYSTEM: INITIALIZING VOODOO FEED...
        </div>

        <div style="display: flex; flex-direction: column; gap: 8px;">
            <input type="text" id="voodoo-name" maxlength="25" placeholder="[ CRAWLER DESIGNATION ]" style="background: #111; border: 1px solid #00ff00; color: #00ff00; padding: 14px; font-family: 'Share Tech Mono', monospace; width: 100%; box-sizing: border-box; font-size: 1.1em;">
            
            <div style="position: relative;">
                <textarea id="voodoo-msg" maxlength="150" oninput="window.updateCharCount(this)" placeholder="[ UNENCRYPTED BURST TRANSMISSION ]&#10;[ MAX 150 CHARS - KEEP IT PG OR GET ACCELERATED ]" style="background: #111; border: 1px solid #00ff00; color: #00ff00; padding: 14px; padding-bottom: 25px; font-family: 'Share Tech Mono', monospace; height: 100px; width: 100%; box-sizing: border-box; resize: none; font-size: 1.1em;"></textarea>
                <span id="char-count" style="position: absolute; bottom: 8px; right: 10px; font-size: 0.8em; color: #00ff00; font-family: 'Share Tech Mono', monospace;">150</span>
            </div>

            <button onclick="window.postToVoodoo()" class="button" style="margin: 0; padding: 16px; font-size: 1.1em;">[ BROADCAST TO SECTOR ]</button>
        </div>
    </div>

    <!-- MESH NETWORK FOOTER (MOVED TO BOTTOM) -->
    <div class="node-footer">
        <strong style="color: #00ff00; font-family: 'Share Tech Mono', monospace; font-size: 1.2em;">[ DRAGON CON MESH ACTIVE ]</strong><br>
        <span style="color: #888; font-family: 'Share Tech Mono', monospace;">NODE ID: !1fcff30a</span><br>
        <a href="https://meshtastic.org/v/#CIrmv_4BElAKCSExZmNmZjMwYRIPb2JpLXdhbi1rZW1lc2hpGgRmMzBhIgbFMx_P8wooWEIgx5cjLfBcMK-Y-ZG_cuCi_jPojvkJoYq-P1lXSvX0YHxIAA" class="button">JOIN THE MESH</a>
        <div style="margin-top: 20px;">
            <a href="mailto:hbar98@gmail.com" style="color: #666; font-family: 'Share Tech Mono', monospace; text-decoration: none; font-size: 0.9em;">[ CONTACT SYSADMIN ]</a>
        </div>
    </div>

    <script>
        window.currentTitle = "";
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx7ljyRllZ4a0OYp3B7Nrfw3Bn3QUMsXrUtJ44RlnDUk9fL8I0AyeocNrw1jXLbnDK6wg/exec';
        const FAVICON_SYSTEM = "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%23000000'/><path fill='%23ffffff' d='M35,20 L55,20 C55,20 60,50 80,65 C85,68 88,72 85,76 C82,80 75,80 70,80 L35,80 C25,80 28,65 30,50 Z'/><circle cx='80' cy='72' r='3' fill='%23000000'/></svg>";
        const FAVICON_DONUT = "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%232a0e2a'/><path fill='%23ffd700' d='M20,60 L80,60 L90,30 L70,50 L50,10 L30,50 L10,30 Z'/><circle cx='50' cy='10' r='6' fill='%23ff69b4'/><circle cx='10' cy='30' r='4' fill='%23ff69b4'/><circle cx='90' cy='30' r='4' fill='%23ff69b4'/></svg>";

        // Ticker Messages (Randomized on Load)
        const SYSTEM_UPDATES = [
          "[SYSTEM PATCH v404.1] Fixed crawler exploit: No more duplicating badge ribbons in skybridge lobbies. Carl, we see you.",
          "[SYSTEM PATCH v404.2] Nerfed 'Humidity Debuff' by 12%‚Äîviewers complained about excessive sweating ASMR. Prepotente still whines.",
          "[SYSTEM PATCH v404.3] Added new achievement: 'Con-Floor Survivor'‚Äî+5 to Crowd Dodge, -10 to Personal Space. Donut approves.",
          "[SYSTEM PATCH v404.4] Emergency hotfix: Elevators now respawn 20% slower. Blame the fire marshal boss encounter.",
          "[SYSTEM PATCH v404.5] Buffed Mongo's 'Tiara Rage' ability‚Äînow shreds vendor booths. Princess Donut petitions granted.",
          "[SYSTEM PATCH v404.6] Removed 'Free Sample Mimic' from food court. 47 crawlers consumed. Apologies to Florin.",
          "[SYSTEM PATCH v404.7] Quasar Legal Update: Class-action nerf to overpriced water vendors. Hydration is now a right.",
          "[SYSTEM PATCH v404.8] Patch notes for patch notes: Fixed AI snark overflow. Mordecai remains disappointed.",
          "[SYSTEM PATCH v404.9] New floor boss: 'The Eternal Line'‚Äîeternal taunt immunity required. Katia, your tank strat OP.",
          "[SYSTEM PATCH v404.10] Donut Mode activated site-wide: +20% sass, pink filters mandatory. Mongo demands tribute.",
          "[SYSTEM PATCH v404.11] Fixed Voodoo Board ghosting‚Äîmessages now persist. No more 'transmission failed' exploits.",
          "[SYSTEM PATCH v404.12] Nerfed Prepotente Panic Meter: Now caps at 95% to prevent server sobs. Mother unavailable.",
          "[SYSTEM PATCH v404.13] Added Mesh Network integration: +10% signal in Hyatt lobbies. Join or perish.",
          "[SYSTEM PATCH v404.14] Emergency buff: 'Con-Crud Resistance Potion' now craftable from pizza boxes. Elle tested.",
          "[SYSTEM PATCH v404.15] Carl Exploit Closed: Foot photos no longer grant god-tier framing kits. Footage scrubbed.",
          "[SYSTEM PATCH v404.16] Odette Showrunner Note: Elevator Fail arc trending‚Äîextended by 48 hours for ratings.",
          "[SYSTEM PATCH v404.17] Fixed achievement generator RNG: 'Sticky Skybridge' now 100% useless as advertised.",
          "[SYSTEM PATCH v404.18] Casandra Ops Patch: Sector Atlanta entity cap raised to 85k. Maintain formation, idiots.",
          "[SYSTEM PATCH v404.19] Zev Marketing Buff: Share buttons now grant +1 viewer engagement. Brag responsibly.",
          "[SYSTEM PATCH v404.20] Growler Gary Cameo: Left Hand Whiskey restocked. 14 donations appreciated.",
          "[SYSTEM PATCH v404.21] Level collapse timer accuracy: Now syncs to Labor Day 5PM. Pack your respawn kit.",
          "[SYSTEM PATCH v404.22] Nerfed carpet hypnosis: 'DO NOT STARE' warning now voice-activated. Saves lives.",
          "[SYSTEM PATCH v404.23] Princess Donut Petition: Tiara booths upgraded to celestial. Mongo chomps approved.",
          "[SYSTEM PATCH v404.24] Quasar Sues Patch: Waivers rewritten‚Äîcrawlers own the fine print now.",
          "[SYSTEM PATCH v404.25] Fixed panic bar overflow: No more 'AAAAAHHHHH!' server crashes. Prepotente muted temporarily.",
          "[SYSTEM PATCH v404.26] New rare drop: 'Priority Elevator Pass (Still Broken)'. Collect 'em all!",
          "[SYSTEM PATCH v404.27] AI Snark Rotation: 47 new Carl roasts added. Feet photos remain copyrighted.",
          "[SYSTEM PATCH v404.28] Voodoo Board Expansion: PG-13 filter strengthened. [REDACTED] transmissions accelerated.",
          "[SYSTEM PATCH v404.29] Final Warning: Skybridge Gauntlet loot table rotated. Survive or reset.",
          "[SYSTEM PATCH v404.30] Buffed 'Badge Line Bypass' exploit‚Äînow requires actual stealth. Carl, your feet won't cut it here.",
          "[SYSTEM WARNING v404.31] WARNING: TAKE A SHOWER. YOU HUMANS ARE DISGUSTING. CON-CRUD SPREADING‚ÄîDONUT'S FUR IS NOT A TOWEL.",
          "[SYSTEM PATCH v404.32] Nerfed shuttle void: Lost crawlers now respawn in the lobby. Florin, no more walkabouts.",
          "[SYSTEM WARNING v404.33] WARNING: HYDRATE OR DIE. PIZZA IS NOT WATER, DESPITE WHAT ELLE CLAIMS AFTER MIDNIGHT.",
          "[SYSTEM PATCH v404.34] Added 'Chaotic Good Vibe' aura‚Äî+15% to parade survival. Prepotente exempt due to panic incompatibility.",
          "[SYSTEM WARNING v404.35] WARNING: DO NOT STARE AT THE CARPET. IT STARES BACK. MORDECAI'S THERAPY BILLS ARE SKYROCKETING.",
          "[SYSTEM PATCH v404.36] Fixed Quasar's lawsuit loop: Bricks can no longer be sued. Occupancy concepts pending review.",
          "[SYSTEM WARNING v404.37] WARNING: ELEVATORS ARE A TRAP. USE STAIRS, FATTIES. CARL, YOUR EXPLOSIVE FEET MIGHT HELP‚ÄîOR NOT.",
          "[SYSTEM PATCH v404.38] Buffed panic text rotation: Now includes 'MOTHERRR!' variants. Viewers love the drama.",
          "[SYSTEM WARNING v404.39] WARNING: NO RED CARPET IN LOBBY? UNACCEPTABLE! DONUT DEMANDS UPGRADES‚ÄîOR MONGO EATS YOUR COSPLAY.",
          "[SYSTEM PATCH v404.40] Nerfed humidity swamp: Debuff now stacks slower. Odette thanks you for the 'sweaty arc' ratings.",
          "[SYSTEM WARNING v404.41] WARNING: BODY PAINT LEVELS CRITICAL. SYSTEM DETECTING DANGEROUS SMEARS‚ÄîWASH OFF BEFORE YOU MELT.",
          "[SYSTEM PATCH v404.42] Added Growler Gary Easter Egg: Whiskey drops now 5% more left-handed. 14 respawns not included.",
          "[SYSTEM WARNING v404.43] WARNING: SLEEP IS OPTIONAL, BUT NOT FOR HUMANS. PASS OUT IN A FUR SUIT? RESPAWN AS CON-CRUD BOSS.",
          "[SYSTEM PATCH v404.44] Fixed Voodoo profanity filter: [REDACTED] now auto-accelerates. Keep it PG, crawlers.",
          "[SYSTEM WARNING v404.45] WARNING: CROWD MANEUVERING REQUIRED. +5 TO DODGE, OR GET TRAMPLED BY THE SAME COSPLAY 47 TIMES.",
          "[SYSTEM PATCH v404.46] Buffed achievement rarity: Celestial tiaras now 1% drop rate. Donut's grudging respect included.",
          "[SYSTEM WARNING v404.47] WARNING: AIR QUALITY ALERT‚ÄîCON-CRUD DETECTED. MASK UP OR BECOME A GHOUL MOB. KATIA, TANK IT.",
          "[SYSTEM PATCH v404.48] Nerfed fire marshal boss: Table flips now 20% less dramatic. Casandra approves formation.",
          "[SYSTEM WARNING v404.49] WARNING: OVERPRICED WATER? EXTORTION! QUASAR SUES HYDRATION‚ÄîBUT YOU STILL NEED TO DRINK, IDIOTS.",
          "[SYSTEM PATCH v404.50] Added Mongo photo op: Signed drops now grant +10 to adorable chomps. Princess demands credit.",
          "[SYSTEM WARNING v404.51] WARNING: THE SUN IS YOUR ENEMY. SURFACE TEMPERATURES RISING‚ÄîSTAY IN THE VOID, CRAWLERS.",
          "[SYSTEM PATCH v404.52] Fixed status rotator: 'SCREAMING VIBE' now audible. Zev says it polls well with Valtay.",
          "[SYSTEM WARNING v404.53] WARNING: HOT GLUE FAILURE IMMINENT. COSPLAY INTEGRITY AT 50%‚ÄîREPAIR OR EXPOSE YOUR SHAME.",
          "[SYSTEM PATCH v404.54] Buffed share options: Bragging now grants minor loot boxes. Don't tell Mordecai.",
          "[SYSTEM WARNING v404.55] WARNING: BADGE LINE CIRCLING BLOCK‚ÄîETERNAL. WITHER AND PERISH, OR USE THE MESH BYPASS.",
          "[SYSTEM PATCH v404.56] Nerfed room line wrap: Now only around the building once. Eternal variant pending.",
          "[SYSTEM WARNING v404.57] WARNING: 3AM WAFFLE HOUSE BOSS ACTIVE. SCATTERED, SMOTHERED, COVERED‚ÄîOR DIE TRYING.",
          "[SYSTEM PATCH v404.58] Added Easter egg overlay: God-tier status now includes actual nothing. Disappointment buffed.",
          "[SYSTEM WARNING v404.59] WARNING: DECORATIVE POTPOURRI IS NOT OATS. CARL, STOP EATING IT. PREPOTENTE MELTDOWN IN 3...2..."
        ];

        // Donut Mode Toggle Logic
        window.toggleDonutMode = function(forceState) {
            // Apply theme toggle
            if (typeof forceState !== 'undefined') {
                if (forceState) document.body.classList.add('donut-theme');
                else document.body.classList.remove('donut-theme');
            } else {
                document.body.classList.toggle('donut-theme');
            }

            // Save state to localStorage
            const isDonut = document.body.classList.contains('donut-theme');
            localStorage.setItem('donutMode', isDonut);

            // Update UI elements based on state
            const header = document.querySelector('.system-ai .header');
            const mainTitle = document.getElementById('main-achievement-title');
            const mainBody = document.getElementById('main-achievement-body');
            const snark = document.querySelector('#main-ai-snark');
            const voodooHeader = document.getElementById('voodoo-header');
            const chatHeader = document.getElementById('live-chat-header');
            const panicHeader = document.getElementById('panic-header');
            const nfcHint = document.getElementById('nfc-hint');
            const favicon = document.getElementById('dynamic-favicon');
            
            // Generator Elements
            const genTitle = document.getElementById('custom-title');
            const genBody = document.querySelector('#gen-container p'); // Target the p inside container
            const genBtn = document.querySelector('#gen-container button');

            if (isDonut) {
                // Header / Intro
                header.innerText = "üëë MONGO'S FAN CLUB üëë";
                mainTitle.innerText = '"OFFICIAL CLUB MEMBER"';
                mainBody.innerHTML = "CONGRATULATIONS! YOU HAVE BEEN SELECTED TO WORSHIP ME AND MONGO! THIS IS THE HIGHEST HONOR AVAILABLE IN THIS DUNGEON. TRY NOT TO EMBARRASS US BY WEARING CROCS. MONGO IS JUDGING YOUR FASHION CHOICES.";
                snark.innerText = "REWARD: ACCESS TO EXCLUSIVE BEHIND-THE-SCENES FOOTAGE OF ME BEING PERFECT. YOU'RE WELCOME!";
                snark.style.color = "#ff99cc";
                
                // Sections
                voodooHeader.innerText = "[ PRINCESS DONUT'S ROYAL FAN CLUB ]";
                chatHeader.innerText = "[ THE ROYAL GOSSIP FEED ]";
                panicHeader.innerText = "[ MONGO APPALL-O-METER ]";
                nfcHint.innerText = "[ ROYAL ALERT: TAP CHIP FOR AN EXCLUSIVE MUSICAL PERFORMANCE! ]";
                
                // Generator
                genTitle.innerText = '"CONSULT THE QUEEN"';
                genBody.innerText = "Receive a royal judgment on your convention performance.";
                genBtn.innerText = "RECEIVE ROYAL EDICT";
                
                if(favicon) favicon.href = FAVICON_DONUT;
            } else {
                // Header / Intro
                header.innerText = "!!! NEW ACHIEVEMENT !!!";
                mainTitle.innerText = '"CON-FLOOR SURVIVOR"';
                mainBody.innerHTML = "YOU DID IT! You‚Äôve successfully navigated the <strong>ATLANTA SKYBRIDGE GAUNTLET</strong>! You have survived the humidity, the smell of burnt rubber and expensive polyester, and the sheer, unadulterated chaos of sixty-thousand humans trying to occupy the same square inch of hotel carpet!";
                
                // Restore random snark if switching back, unless page just loaded
                if (typeof forceState === 'undefined') {
                    const randomSnark = AI_SNARKS[Math.floor(Math.random() * AI_SNARKS.length)];
                    snark.innerText = `REWARD: ${randomSnark}`;
                }
                snark.style.color = "#ffa500";
                
                // Sections
                voodooHeader.innerText = "[ VOODOO BOARD ]";
                chatHeader.innerText = "[ LIVE SYSTEM CHAT ]";
                panicHeader.innerText = "[ PREPOTENTE PANIC METER ]";
                nfcHint.innerText = "[ SYSTEM WARNING: PROXIMITY SCAN DETECTED. TAP CHIP FOR UNSTABLE DATA UPLOAD ]";
                
                // Generator
                genTitle.innerText = '"TAP FOR FATE"';
                genBody.innerText = "Generate a useless achievement based on your level of survival.";
                genBtn.innerText = "GENERATE ACHIEVEMENT";

                if(favicon) favicon.href = FAVICON_SYSTEM;
            }
            
            // Re-init meters/stats immediately to switch status text/colors
            window.initPanicMeter();
            window.initLiveStats();
        };

        // Crawler ID Logic
        window.initCrawlerID = function() {
            let id = localStorage.getItem('crawlerID');
            if (!id) {
                // Generate random ID: #100,000 to #999,999
                id = '#' + Math.floor(Math.random() * 900000 + 100000).toLocaleString();
                localStorage.setItem('crawlerID', id);
            }
            // Update display
            const idDisplay = document.getElementById('crawler-id');
            if(idDisplay) {
                 idDisplay.innerText = `WELCOME, CRAWLER ${id}`;
            }
        };

        // Random Snark Array
        const AI_SNARKS = [
            "Carl, stop looking at that booth. We have a schedule!",
            "THE ELEVATORS ARE STILL BROKEN, CARL!",
            "Princess Donut demands you acknowledge Mongo immediately.",
            "Prepotente is having a meltdown in 3... 2... 1...",
            "I've detected 47 people wearing the same cosplay. This is a nightmare.",
            "Carl, those aren't oats. Please stop eating the decorative potpourri.",
            "Mordecai wants you to know he's very disappointed in your choices.",
            "SYSTEM: Detecting dangerous levels of body paint and humidity.",
            "Carl, look at the feet on these people! WHY DO YOU DO THIS TO ME?!"
        ];

        // Dynamic Chat Data
        const CHAT_CHARACTERS = [
            {
                id: 'donut',
                name: 'Princess Donut Lvl 50 Queen Anne Chonk',
                lines: [
                    "CARL! MONGO IS APPALLED! WHY ARE ALL THESE PEOPLE LOOKING AT A MAN IN A SPANDEX ONESIE? TELL THE NETWORK ADMIN TO BROADCAST MY IMAGE ON EVERY SCREEN IN THE HYATT IMMEDIATELY!",
                    "CARL! I FOUND A BOOTH SELLING TIARAS, BUT THEY ARE CLEARLY INFERIOR QUALITY. MONGO TRIED TO EAT ONE. IT WAS ADORABLE.",
                    "WHY IS EVERYONE SWEATING? IT IS DISGUSTING. MORDECAI, MAKE THE AIR CONDITIONING COLDER! USE YOUR MANAGER POWERS!",
                    "CARL! THAT ROBOT JUST BEEPED AT ME! IS IT A BOMB? IT'S PROBABLY A BOMB. MONGO, DESTROY IT!",
                    "I AM THE QUEEN OF THIS CONVENTION! WHY IS THERE NO RED CARPET IN THE LOBBY? UNACCEPTABLE!",
                    "CARL! SIGNET SAYS SHE FOUND A BOOTH WITH CATNIP. WE ARE GOING THERE. NOW!",
                    "CARL! THIS PANEL ROOM IS UNFIT FOR ROYALTY! THE CHAIRS ARE PLASTIC! MORDECAI, DEMAND THEY BRING IN A THRONE IMMEDIATELY OR MONGO WILL EAT THE PROJECTOR!",
                    "OH, LOOK AT THAT PITIFUL COSPLAY OF A PRINCESS! IT'S AN INSULT TO TRUE QUEENS LIKE ME. CARL, TAKE A PHOTO SO I CAN SHOW THE VIEWERS HOW TO DO IT PROPERLY!",
                    "WHY ARE THESE HUMANS NOT BOWING? I AM PRINCESS DONUT! MONGO, DEMONSTRATE YOUR MAJESTY‚ÄîBUT DON'T STEP ON THE MERCH, IT MIGHT BE EDIBLE.",
                    "CARL! THAT BOOTH HAS SPARKLY ACCESSORIES, BUT THEY'RE FAKE GEMS! WE MUST ACQUIRE THEM ANYWAY. MORDECAI, USE YOUR MAGIC TO UPGRADE THEM TO CELESTIAL QUALITY!",
                    "THIS HUMIDITY IS RUINING MY FUR! CARL, FIND ME A FAN CLUB TO WORSHIP ME WHILE I POSE. MONGO APPROVES‚ÄîHE'S ALREADY CHEWING ON A BADGE LANYARD!"
                ]
            },
            {
                id: 'prepotente',
                name: 'Prepotente (Pony Extraordinaire)',
                lines: [
                    "AAAAAAAAAAHHHHHH! MOTHER! THE ELEVATORS ARE A BORANT CONSPIRACY! THEY WANT US TO STARVE ON THE SKYBRIDGE! AAAAAAAAAAHHHHHHH!",
                    "AAAAAAAAAAHHHHHH! THE LINE FOR BADGES IS ETERNAL! I WILL WITHER AND PERISH BEFORE I GET MY LANYARD! AAAAAAAAAAHHHHHHH!",
                    "AAAAAAAAAAHHHHHH! THAT MAN IS DRESSED AS A WOLF! HE IS A FRAUD! AAAAAAAAAAHHHHHHH!",
                    "AAAAAAAAAAHHHHHH! I HAVE EATEN A STICKER! IT TASTES OF ADHESIVE AND REGRET!",
                    "AAAAAAAAAAHHHHHH! MOTHER! THIS DEALER'S HALL IS A LABYRINTH OF DOOM! I DEMAND PREMIUM OATS AT EVERY BOOTH OR I'LL STAMPEDE THE LINE!",
                    "AAAAAAAAAAHHHHHH! THAT COSPLAYER JUST STEPPED ON MY HOOF! IT'S ASSAULT! CARL, YOU COLOSSAL DOLT, WHY DIDN'T YOU WARN ME ABOUT THESE FERAL HUMANS?",
                    "AAAAAAAAAAHHHHHH! THE WIFI IS DOWN! HOW WILL I BROADCAST MY PANIC TO THE VIEWERS? MOTHER, SAVE ME FROM THIS DIGITAL ABYSS!",
                    "AAAAAAAAAAHHHHHH! THAT PANEL ON PONIES IS FULL OF FRAUDS! MOTHER, THEY DON'T UNDERSTAND TRUE EQUINE EXCELLENCE LIKE ME!"
                ]
            },
            {
                id: 'katia',
                name: 'Katia (Level 42 Tank)',
                lines: [
                    "Carl, I‚Äôve found a path through the food court, but it‚Äôs guarded by a Level 60 'Line for Pizza.' We need to use this mesh node to coordinate the bypass!",
                    "I just saw a crawler dual-wielding light sabers. I don't think that's in the rulebook, Carl. Should we be worried?",
                    "My map says the panel is in this room, but it's just a closet full of chairs. Is this a trap?",
                    "I think I just accidentally joined a cult in the gaming hall. They gave me a ribbon.",
                    "Carl, the skybridge is a chokepoint‚ÄîLevel 50 'Crowd Surge' ahead. We could flank via the stairs, but watch for that rogue escalator trap.",
                    "I spotted a group stuck in the badge pickup line; it's like a bubble quest. Should we coordinate a rescue with the mesh? I don't want to leave them behind.",
                    "My badge says the art alley is clear, but it's probably a mimic booth. Carl, let's test it with a probe‚Äîmaybe throw a free sticker?",
                    "Accidentally joined a LARP group in the lobby; they thought my tank build was cosplay. Now I'm committed‚Äîanyone got tips for improvising a shield from a program booklet?",
                    "This humidity debuff is stacking; we need a hydration station bypass. Carl, your explosive feet might clear a path, but let's not blow up the con-crud vendors."
                ]
            },
            {
                id: 'mordecai',
                name: 'Mordecai (Manager)',
                lines: [
                    "Stop screaming! Prepotente, the elevators have been broken since the tenth floor. Crawler, keep that signal steady! We need a clear link before the Skybridge becomes a total chokepoint.",
                    "Donut, for the last time, you cannot join the parade. You are a cat. Carl, focus on the objective. We need to find the charging station.",
                    "If I see one more person doing the Macarena, I'm going to have an aneurysm. Keep moving, Crawlers.",
                    "Drink water. I don't want to have to explain to the showrunners why my crawlers passed out in a fur suit.",
                    "Donut, no, you can't demand a parade float‚Äîthat's a ratings trap. Focus on the objective: find the saferoom booth before the fire marshal shuts it down.",
                    "If I have to explain one more time why overpriced con snacks aren't potions... Drink your water, crawlers, or I'll brew something that'll make you regret it.",
                    "Prepotente, calm your panic‚Äîthe elevators are a known hazard since floor one. Stick to the plan, or you'll end up like my brother: lost in the chaos.",
                    "You can't save every lost cosplayer, Carl. But... fine, let's reroute. Just don't tell Odette; she'd turn it into a drama episode.",
                    "This mesh network is unstable‚Äîreminds me of that cursed guild on floor five. Keep signals low, or we'll attract the wrong kind of attention."
                ]
            },
            {
                id: 'quasar',
                name: 'Quasar (Legal Counsel/Certified Genius)',
                lines: [
                    "CHOKEPOINT? I‚Äôll sue the very concept of occupancy! I‚Äôll sue the bricks! CRAWLER, YOUR RIGHT TO STAND HERE IS PROTECTED!",
                    "Overpriced water? That's extortion! I'll file a class-action lawsuit against hydration itself! I'll sue the molecule!",
                    "They wouldn't let me into the VIP lounge? I'll buy the lounge! Then I'll sue the bouncer for emotional distress!",
                    "This badge requires a waiver? I don't sign waivers, I rewrite them! I OWN THE FINE PRINT!",
                    "BADGE LINE TOO LONG? THAT'S A VIOLATION OF CRAWLER RIGHTS! I'LL SUE THE CONVENTION CENTER, THE VOLUNTEERS, AND TIME ITSELF!",
                    "This overpriced swag? Extortion! I'll file against the vendors, the economy, and the concept of capitalism‚Äîyour loot is protected, crawler!",
                    "They banned my briefcase in the panel room? I'll acquire the whole hotel! Then sue the security for infringing on my genius!",
                    "Humidity clause in the terms? I didn't sign that! I'll rewrite the weather contract and sue the clouds for emotional damages!",
                    "No VIP access? Unacceptable! I'll litigate the hierarchy, buy the elite lounge, and countersue gravity for holding us down!"
                ]
            },
            {
                id: 'casandra',
                name: 'Casandra (Exasperated Operations)',
                lines: [
                    "EVERYONE SHUT UP! Crawler, keep the mesh open. If I lose my tactical overview, I will personally rewrite your respawn protocol!",
                    "I am tracking 50,000 entities in this sector and they are all moving randomly. It's tactical suicide. Maintain formation!",
                    "Who unauthorized this broadcast? Actually, never mind. Just keep the signal up. I need to monitor the buffet line.",
                    "If one more person asks me where the bathroom is, I'm going to start venting atmosphere.",
                    "QUIET, ALL OF YOU! Crawler, maintain the perimeter‚ÄîI've got 60,000 entities on radar, and they're all converging on the autograph line. Formation now!",
                    "Who greenlit this parade route? It's a tactical nightmare! Signal the bypass, or I'll vent the entire skybridge myself.",
                    "Another elevator outage? Unauthorized! Keep the mesh stable‚ÄîI need eyes on the food court before it turns into a battlefield.",
                    "If one more crawler asks for directions to the bathroom, I'll rewrite the floor map! Focus on survival, not side quests!",
                    "Tracking cosplay mobs‚Äîrandom movement patterns. Hold position, or this sector becomes a respawn zone. Shut up and listen!"
                ]
            },
            {
                id: 'odette',
                name: 'Odette (Showrunner)',
                lines: [
                    "Ratings are down in the Vendor Hall. Spice it up! Maybe start a small fire? Just a little one.",
                    "Who authorized that cosplay? It infringes on Borant copyright. I want names!",
                    "I need more drama in the food court! Someone flip a table! The viewers are bored!",
                    "Look at those engagement numbers! The 'Elevator Failure' arc is testing really well with the Valtay.",
                    "Viewer numbers dipping in the gaming hall? Let's amp it‚Äîstart a flash mob or a fake feud. The Valtay eat up that chaos!",
                    "That elevator jam is gold for the 'Survival Arc'! Keep it rolling‚Äîwho authorized the fix? I need more suffering for the highlights!",
                    "Cosplay infringement? Perfect scandal! Get names, flip a table if needed‚Äîthe engagement from outrage is chef's kiss.",
                    "Bored in the vendor hall? Ignite a small bidding war‚Äîjust enough fire for ratings. Remember, the longer the drama, the bigger my payout!",
                    "Look at those skybridge stats! The 'Humidity Hell' episode is trending. Push the crawlers harder‚Äîviewers love a breakdown!"
                ]
            },
            {
                id: 'elle',
                name: 'Elle',
                lines: [
                    "Well hello there, tall, dark, and armored. Care to share a potion?",
                    "I saw a barbarian in the lobby who could definitely crush a melon. I'm intrigued.",
                    "My feet hurt, but this outfit is worth the pain. Stop staring... actually, don't stop.",
                    "Anyone want to help me find some trouble? The fun kind, obviously.",
                    "Yo, barkeep at the con bar! Whose ass do I gotta freeze to get a shot? This humidity's meltin' my icicles‚Äîgimme somethin' strong!",
                    "Saw a hunk in armor by the elevators‚Äîhey, tall and sweaty, wanna share a potion? My feet are killin' me, but the view's worth it.",
                    "You mess with Carl's crew, I'll shatter your badge like glass! Come at us, and your blood turns to slush‚Äînow who's buyin' the next round?",
                    "This outfit's hot as hell, but damn if it don't turn heads. Stop starin'... or don't, I could use the ego boost after that line wait.",
                    "Accidentally iced a pushy vendor‚Äîoops, no remorse! Barry'd laugh; now, anyone up for trouble? The drunk kind, obviously."
                ]
            },
            {
                id: 'florin',
                name: 'Florin',
                lines: [
                    "Oi! Watch your back in the dealer's room, mates. It's a bloody shark tank in there.",
                    "Reckon we bypass the shuttle line. It's chock-a-block. We walk.",
                    "Don't be a drongo. That 'free' sample is definitely trapped.",
                    "Fair dinkum, the prices at the food court are daylight robbery. Who's got rations?",
                    "Oi, mates, that shuttle queue's a bloody ambush‚Äîchockers with traps. Let's leg it; no drongo waits for that nonsense.",
                    "Watch yer six in the panel room; smells like a setup. If ya need backup, I'm in‚Äîdebts paid with bullets, yeah?",
                    "Fair dinkum, this con's prices are robbery. Who's packin' rations? Can't fight on empty, especially after losin' my ray of light.",
                    "That cosplay mob's dodgy‚Äîwrapped 'round the buildin'. Bypass it, or we'll wither like I almost did. For Ife, we push on.",
                    "Broodin' over the skybridge chaos‚Äîreminds me of lost mates. But Carl, ya pulled me back; need a gun? I'm yers."
                ]
            },
            {
                id: 'zev',
                name: 'Zev (Marketing)',
                lines: [
                    "We're live in 5! Look heroic! Flex something! The outer systems are watching!",
                    "The sponsors love the spandex look! Can you strike a pose near the trash can? It's 'gritty'.",
                    "Can we get a close up on that badge? It's shiny! Shiny things poll well with the kuo-toa!",
                    "Donut! The camera loves you! Ignore the goblin, look at the lens!",
                    "Live in 5, crawlers! Strike a pose by that booth‚Äîthe sponsors adore the chaos aesthetic. Flex for the outer systems!",
                    "Donut, the camera's obsessed with you! Ignore the line wait; look fierce‚Äîshiny badges poll huge with the kuo-toa viewers!",
                    "Ratings spiking on the elevator fail! Can we get a gritty shot near the trash? It's trending‚Äîkeep surviving for that mutual win!",
                    "We're golden on engagement‚Äîthe 'Con-Crud Arc' is hot. Listen up: follow my lead, or the AI notices. Gossip Girl collab post-crawl?",
                    "Focus group loves the humidity drama! Pose heroic, ignore the goblin cosplay‚Äîviewers eat it up. You're stars; don't die on me!"
                ]
            }
        ];

        window.headerTapCount = 0;
        window.tapTimer = null;

        window.trackHeaderTaps = function() {
            window.headerTapCount++;
            clearTimeout(window.tapTimer);
            if (window.headerTapCount >= 5) {
                window.triggerEasterEgg();
                window.headerTapCount = 0;
            } else {
                window.tapTimer = setTimeout(() => { window.headerTapCount = 0; }, 2000);
            }
        };

        window.triggerEasterEgg = function() {
            document.body.classList.add('glitch');
            document.getElementById('panic-fill').style.width = '100%';
            document.getElementById('panic-text').innerText = "‚ö†Ô∏è SYSTEM CRITICAL: CARL IS CHEATING!";
            document.getElementById('easter-egg-overlay').style.display = 'flex';
        };

        window.closeEasterEgg = function() {
            document.body.classList.remove('glitch');
            document.getElementById('easter-egg-overlay').style.display = 'none';
            window.initPanicMeter();
        };

        window.chatInterval = null;
        
        window.initChatCycle = function() {
            const container = document.getElementById('character-feed');
            container.innerHTML = ''; 
            
            // Initial fill
            for(let i=0; i<4; i++) {
                window.addChatMessage();
            }

            if (window.chatInterval) clearInterval(window.chatInterval);
            window.chatInterval = setInterval(window.addChatMessage, 9000);
        };

        window.addChatMessage = function() {
            const container = document.getElementById('character-feed');
            // Use random chat line logic
            const char = CHAT_CHARACTERS[Math.floor(Math.random() * CHAT_CHARACTERS.length)];
            const line = char.lines[Math.floor(Math.random() * char.lines.length)];
            
            const entry = document.createElement('div');
            entry.className = `chat-entry ${char.id} fade-in`;
            entry.innerHTML = `<span class="username">${char.name}</span>${line}`;
            
            container.appendChild(entry);
            
            // Limit to 5 visible messages
            if (container.children.length > 5) {
                container.removeChild(container.firstChild);
            }
        };

        window.onload = function() {
            // Populate Ticker
            const tickerEl = document.getElementById('system-ticker');
            // Shuffle array for randomness
            const shuffledUpdates = [...SYSTEM_UPDATES].sort(() => 0.5 - Math.random());
            // Join with a separator
            tickerEl.innerText = shuffledUpdates.join("   ///   ");

            // Apply random snark
            const randomSnark = AI_SNARKS[Math.floor(Math.random() * AI_SNARKS.length)];
            document.getElementById('main-ai-snark').innerText = `REWARD: ${randomSnark}`;

            // Initialize Crawler ID
            window.initCrawlerID();

            // Check for saved theme
            const savedTheme = localStorage.getItem('donutMode');
            if (savedTheme === 'true') {
                window.toggleDonutMode(true);
            }

            // Generate Dynamic Chat
            window.initChatCycle();
            
            // Auto-fill Crawler Designation from LocalStorage
            const savedName = localStorage.getItem('crawlerName');
            const crawlerID = localStorage.getItem('crawlerID');
            const voodooInput = document.getElementById('voodoo-name');

            if (savedName) {
                voodooInput.value = savedName;
            } else if (crawlerID) {
                // Auto-fill generated ID if no saved name
                voodooInput.value = `Crawler ${crawlerID}`;
            }

            // Init Dynamic Statuses
            setTimeout(function() {
                window.loadVoodooMessages();
                // Refresh Voodoo every 30 seconds
                setInterval(window.loadVoodooMessages, 30000);
                
                window.initPanicMeter();
                window.initLiveStats();
            }, 500);
        };

        // Panic Meter Logic
        window.panicInterval = null;
        window.initPanicMeter = function() {
            if (window.panicInterval) clearInterval(window.panicInterval);
            const fill = document.getElementById('panic-fill');
            const text = document.getElementById('panic-text');
            const isDonut = document.body.classList.contains('donut-theme');
            
            // Separate Status Pools
            const prepotenteStatuses = [
                "AAAAAAHHHHH!",
                "ELEVATOR SABOTAGE!",
                "OATS DEPLETION!",
                "MOTHERRR!",
                "UNACCEPTABLE!",
                "CONTROLLED SOBBING",
                "THE SKYBRIDGE IS A TRAP!",
                "WHERE IS MY LANYARD?!",
                "TOO MANY PEOPLE!",
                "I REQUIRE PREMIUM OATS!",
                "THE CARPET IS MOVING!",
                "DIGNITY CRITICAL!"
            ];

            const mongoStatuses = [
                "THE LACK OF SNACKS",
                "YOUR CHEAP SHOES",
                "GRAVY BOAT",
                "THE BUFFET LINE",
                "THAT BADGE PHOTO",
                "PLASTIC TIARAS",
                "THE HUMIDITY",
                "THAT AWFUL WIG",
                "UNAUTHORIZED HEAD PATS",
                "THAT COCKER SPANIEL"
            ];

            window.panicInterval = setInterval(() => {
                // Range 60% to 100% for visible movement
                const newWidth = Math.floor(Math.random() * (100 - 60 + 1)) + 60;
                fill.style.width = newWidth + '%';
                
                // Pick a random status based on theme
                let randomStatus;
                if(isDonut) {
                     randomStatus = mongoStatuses[Math.floor(Math.random() * mongoStatuses.length)];
                     text.innerText = `ü¶ñ MONGO IS APPALLED BY: ${randomStatus}`;
                     
                     // Donut Mode Colors (Pink/Purple)
                     if (newWidth > 90) {
                        text.style.color = "#ff1493"; // Deep Pink
                        fill.style.background = "linear-gradient(90deg, #ff69b4, #ff1493)";
                     } else if (newWidth < 75) {
                        text.style.color = "#ffb6c1"; // Light Pink
                        fill.style.background = "linear-gradient(90deg, #ffb6c1, #ff69b4)";
                     } else {
                        text.style.color = "#ff69b4"; // Hot Pink
                        fill.style.background = "linear-gradient(90deg, #ff69b4, #ff1493)";
                     }

                } else {
                     // System Mode (Prepotente)
                     randomStatus = prepotenteStatuses[Math.floor(Math.random() * prepotenteStatuses.length)];
                     text.innerText = `üêê CURRENT STATUS: ${randomStatus}`;
                     
                     // System Mode Colors (Red/Yellow/Orange)
                     if (newWidth > 90) {
                        text.style.color = "#ff0000"; // Red
                        fill.style.background = "linear-gradient(90deg, #ff4500, #ff0000)";
                    } else if (newWidth < 75) {
                        text.style.color = "#fdfd96"; // Yellow
                        fill.style.background = "linear-gradient(90deg, #fdfd96, #ffcc00)";
                    } else {
                        text.style.color = "#ff8c00"; // Orange
                        fill.style.background = "linear-gradient(90deg, #ffcc00, #ff4500)";
                    }
                }
            }, 3000);
        };

        // Live Stats Logic (Dynamic Status Lines)
        window.statsInterval = null;
        window.statusRotationInterval = null;
        
        window.initLiveStats = function() {
            if (window.statsInterval) clearInterval(window.statsInterval);
            if (window.statusRotationInterval) clearInterval(window.statusRotationInterval);

            // Pool of random statuses for SYSTEM MODE
            const systemStatusPool = [
                { label: "ELEVATORS", value: "[CRITICAL FAILURE]", color: "#ff0000" },
                { label: "ELEVATORS", value: "FULL. ALWAYS FULL.", color: "#ffcc00" },
                { label: "TEMPERATURE", value: "SURFACE OF THE SUN", color: "#ff4500" },
                { label: "HUMIDITY", value: "SWAMP CONDITIONS", color: "#00ccff" },
                { label: "ROOM LINE", value: "ETERNAL", color: "#ff0000" },
                { label: "ROOM LINE", value: "WRAPPED AROUND BUILDING", color: "#ffcc00" },
                { label: "CURRENT BOSS", value: "THE FIRE MARSHAL", color: "#ff0000" },
                { label: "CURRENT BOSS", value: "3AM WAFFLE HOUSE", color: "#ffcc00" },
                { label: "CURRENT BOSS", value: "THE SUN", color: "#ffcc00" },
                { label: "SECTOR POP", value: "85,420 [OVERCROWDED]", color: "#ffcc00" },
                { label: "AIR QUALITY", value: "CON-CRUD DETECTED", color: "#00ff00" },
                { label: "HYDRATION", value: "PIZZA IS NOT WATER", color: "#00ccff" },
                { label: "SHUTTLE", value: "LOST IN THE VOID", color: "#ff0000" },
                { label: "CARPET", value: "DO NOT STARE", color: "#cc00ff" },
                { label: "VIBE", value: "SCREAMING", color: "#ff0000" },
                { label: "VIBE", value: "CHAOTIC GOOD", color: "#00ff00" },
                { label: "COSTUME", value: "HOT GLUE FAILURE", color: "#ffcc00" },
                { label: "BADGE LINE", value: "CIRCLING THE BLOCK", color: "#ff0000" },
                { label: "SLEEP", value: "OPTIONAL", color: "#00ccff" }
            ];

            // Pool of random statuses for DONUT MODE
            const donutStatusPool = [
                { label: "MONGO'S MOOD", value: "A GOOD BOY", color: "#ff69b4" },
                { label: "MONGO'S MOOD", value: "HANGRY", color: "#ff0000" },
                { label: "MONGO'S MOOD", value: "CHEWING ON COSPLAYER", color: "#ff1493" },
                { label: "GLITTER LEVEL", value: "BLINDING", color: "#ffccff" },
                { label: "GLITTER LEVEL", value: "EVERYWHERE", color: "#ff69b4" },
                { label: "FAN WORSHIP", value: "DEAFENING", color: "#ff1493" },
                { label: "FAN WORSHIP", value: "ACCEPTABLE", color: "#ff69b4" },
                { label: "CARL'S FEET", value: "STILL GROSS", color: "#8b4513" },
                { label: "TIARA SHINE", value: "MAXIMUM", color: "#ffd700" },
                { label: "TREAT SUPPLY", value: "CRITICALLY LOW", color: "#ff0000" },
                { label: "TREAT SUPPLY", value: "PLENTIFUL", color: "#00ff00" },
                { label: "NUGGETS", value: "ACQUIRED", color: "#00ff00" },
                { label: "HAVOK", value: "IMMINENT", color: "#ff4500" },
                { label: "SIGNET", value: "IN THE WAY", color: "#ff0000" },
                { label: "STYLE", value: "IMPECCABLE", color: "#ff69b4" }
            ];

            const updateStatuses = () => {
                const isDonut = document.body.classList.contains('donut-theme');
                const pool = isDonut ? donutStatusPool : systemStatusPool;
                
                // Update Header
                const statusHeader = document.querySelector('.floor-status .status-header');
                if(statusHeader) {
                    statusHeader.innerText = isDonut ? "[ ROYAL STATUS UPDATE ]" : "[ LIVE FLOOR STATUS: SECTOR ATLANTA ]";
                }

                // Shuffle and pick 3 unique items
                const shuffled = [...pool].sort(() => 0.5 - Math.random());
                const selected = shuffled.slice(0, 3);
                
                for(let i=0; i<3; i++) {
                    const el = document.getElementById(`status-row-${i+1}`);
                    if(el) {
                        el.innerHTML = `üî∏ ${selected[i].label}: <span style="color: ${selected[i].color}; font-weight: bold;">${selected[i].value}</span>`;
                    }
                }
            };

            // Run immediately and then rotate every 12 seconds
            updateStatuses();
            window.statusRotationInterval = setInterval(updateStatuses, 12000);

            // Level Collapse Timer Logic (Labor Day 5PM)
            const timerEl = document.getElementById('level-timer');
            const now = new Date();
            const year = now.getFullYear();
            
            // Calculate Labor Day (1st Monday of Sept)
            let laborDay = new Date(year, 8, 1); 
            while (laborDay.getDay() !== 1) {
                laborDay.setDate(laborDay.getDate() + 1);
            }
            laborDay.setHours(17, 0, 0, 0);

            // If passed, target next year
            if (now > laborDay) {
                laborDay.setFullYear(year + 1);
                laborDay.setMonth(8);
                laborDay.setDate(1);
                while (laborDay.getDay() !== 1) {
                    laborDay.setDate(laborDay.getDate() + 1);
                }
                laborDay.setHours(17, 0, 0, 0);
            }

            window.statsInterval = setInterval(() => {
                const currentTime = new Date().getTime();
                const distance = laborDay.getTime() - currentTime;

                if (distance < 0) {
                    timerEl.innerText = "COLLAPSE IMMINENT";
                    return;
                }

                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                timerEl.innerText = `${days}d ${hours}h ${minutes}m ${seconds}s`;
            }, 1000);
        };

        window.generateAchievement = function() {
            const isDonut = document.body.classList.contains('donut-theme');
            let adj, noun, vPast, vIng, body, reward, title;

            if (!isDonut) {
                // --- SYSTEM AI MODE ---
                const adjectives = ["Legendary", "Decrepit", "Glistening", "Appalled", "Celestial", "Malfunctioning", "Stinky", "Exasperated", "Unhinged", "Copyright-Infringing", "God-Tier", "Sticky", "Slime-Covered", "Aggressive"];
                const nouns = ["Skybridge", "Tiara", "Oats", "Packet", "Llama", "Cosplayer", "Holocron", "Badge", "Elevator", "Con-Crud", "Foot-Photo", "Vendor-Hall", "Service-Lift"];
                const verbsPast = ["wrangled", "evaded", "glurped", "sued", "screamed at", "infiltrated", "buffered", "ignored", "acquired", "over-clocked", "petted", "dismantled"];
                const verbsIng = ["wrangling", "evading", "glurping", "suing", "screaming at", "infiltrating", "buffering", "ignoring", "acquiring", "over-clocking", "petting", "dismantling"];

                const pick = (arr) => arr[Math.floor(Math.random() * arr.length)];
                const roll = Math.floor(Math.random() * verbsPast.length);

                adj = pick(adjectives);
                noun = pick(nouns);
                vPast = verbsPast[roll];
                vIng = verbsIng[roll];

                const article = /^[aeiou]/i.test(adj) ? "an" : "a";
                const isPlural = ["Oats", "Foot-Photo", "Badge-Ribbon"].includes(noun);
                const fullNoun = isPlural ? `${adj} ${noun}` : `${article} ${adj} ${noun}`;

                const bodies = [
                    `You have ${vPast} ${fullNoun} in a way that makes the AI very uncomfortable.`,
                    `Against all odds, you successfully ${vPast} ${fullNoun} without causing a sector-wide reset.`,
                    `By ${vIng} ${fullNoun}, you have officially peaked. It's all downhill from here.`,
                    `The AI noticed you ${vPast} ${fullNoun}. It's currently writing a creepy poem about it.`,
                    `You just ${vPast} ${fullNoun}. Mordecai is sighing so hard he might pass out.`
                ];

                reward = "A Common Quality Cotton Sock.";
                if (noun === "Tiara") reward = "Princess Donut's grudging respect.";
                else if (noun === "Oats") reward = "10 seconds of silence from Prepotente.";
                else if (noun === "Foot-Photo") reward = "A [God-Tier] digital framing kit.";
                else reward = pick(["Priority Elevator Access (Still Broken).", "A Signed Photo of Mongo.", "+5 to Humidity Resistance.", "A commemorative pin that says 'I Tried'."]);
                
                body = pick(bodies);
                title = `"${adj} ${noun}"`;

            } else {
                // --- DONUT MODE ---
                const dAdjectives = ["Sparkly", "Royal", "Inferior", "Acceptable", "Divine", "Glitzy", "Hideous", "Perfect", "Dazzling", "Unworthy"];
                const dNouns = ["Tiara", "Fan Club", "Paparazzi", "Selfie", "Treat", "Catnip", "Spotlight", "Cosplay", "Red Carpet", "Sunglasses", "Peasant"];
                const dVerbsPast = ["dazzled", "commanded", "outshined", "summoned", "judged", "blessed", "scolded", "ignored", "adopted"];
                
                const pick = (arr) => arr[Math.floor(Math.random() * arr.length)];
                const roll = Math.floor(Math.random() * dVerbsPast.length);

                adj = pick(dAdjectives);
                noun = pick(dNouns);
                vPast = dVerbsPast[roll];
                
                const article = /^[aeiou]/i.test(adj) ? "an" : "a";
                const fullNoun = `${article} ${adj} ${noun}`;

                const dBodies = [
                    `MONGO IS PLEASED! You have ${vPast} ${fullNoun} with adequate style.`,
                    `Finally, someone who understands! You ${vPast} ${fullNoun} perfectly. Carl, take notes!`,
                    `I saw you ${vPast} ${fullNoun}. It was ALMOST as good as when I do it. Almost.`,
                    `You ${vPast} ${fullNoun}. The viewers love it! Our engagement metrics are spiking!`,
                    `Ugh. You ${vPast} ${fullNoun}? Really? Without glitter? Fix it immediately.`
                ];

                reward = pick([
                    "Permission to look at me for 5 seconds.",
                    "A glitter bomb (It gets everywhere).",
                    "A 'Mongo Approved' sticker.",
                    "The honor of holding my sunglasses.",
                    "A shoutout on the chat (Maybe).",
                    "One (1) singular celestial treat."
                ]);

                body = pick(dBodies);
                title = `"${adj.toUpperCase()} ${noun.toUpperCase()}"`;
            }

            const container = document.getElementById('gen-container');
            container.classList.remove('glitch', 'rarity-common', 'rarity-legendary', 'rarity-celestial');
            void container.offsetWidth; 
            container.classList.add('glitch');

            const rarity = (isDonut || Math.random() > 0.7) ? (Math.random() > 0.5 ? "rarity-legendary" : "rarity-celestial") : "rarity-common";
            container.classList.add(rarity);

            window.currentTitle = title; // Update global for sharing
            document.getElementById('custom-header').innerText = isDonut ? "ROYAL DECREE ISSUED!" : "NEW ACHIEVEMENT!";
            document.getElementById('custom-title').innerText = title;
            document.getElementById('custom-body').innerText = `${body}\n\nREWARD: ${reward}`;
            document.getElementById('share-options').style.display = 'block';
        };

        window.getShareText = function() {
            return `I just earned the "${window.currentTitle}" achievement at Dragon Con! Don't tell Mordecai: hbar98.github.io #DragonCon #DCC`;
        };

        window.shareX = function() { window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(window.getShareText())}`, '_blank'); };
        window.shareBlueSky = function() { window.open(`https://bsky.app/intent/compose?text=${encodeURIComponent(window.getShareText())}`, '_blank'); };
        window.shareThreads = function() { window.open(`https://www.threads.net/intent/post?text=${encodeURIComponent(window.getShareText())}`, '_blank'); };

        window.copyToClipboard = function(e) {
            if (!navigator.clipboard) {
                const textArea = document.createElement("textarea");
                textArea.value = window.getShareText();
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    const btn = e.target;
                    const originalText = btn.innerText;
                    btn.innerText = "COPIED!";
                    setTimeout(() => { btn.innerText = originalText; }, 2000);
                } catch (err) {}
                document.body.removeChild(textArea);
                return;
            }
            navigator.clipboard.writeText(window.getShareText()).then(() => {
                const btn = e.target;
                const originalText = btn.innerText;
                btn.innerText = "COPIED!";
                setTimeout(() => { btn.innerText = originalText; }, 2000);
            });
        };

        // Enhanced Profanity Filter
        window.sanitize = function(str) {
            if (!str) return "";
            let clean = str.replace(/<\/?[^>]+(>|$)/g, "");
            
            // Enhanced word list with common variants and leetspeak
            const blockedWords = [
                "fuck", "fuk", "fck", "f u c k", "sh!t", "shit", "sh1t", "bitch", "b!tch", "b1tch",
                "cunt", "twat", "wank", "pussy", "dick", "d1ck", "cock", "penis", "vagina",
                "asshole", "a$$hole", "bastard", "slut", "whore",
                "nazi", "n@zi", "racist", "fag", "f@g", "nigger", "nigga", "n1gger", "kike", "spic",
                "retard", "r3tard", "chink", "tranny", "shemale", "dyke", "gook", "beaner", "coon",
                "rapist", "pedophile", "pedo", "pdf file", "PDF file"
            ];
            
            blockedWords.forEach(word => {
                // Case-insensitive and catches variations with spaces/symbols
                const regex = new RegExp(word.split('').join('[\\s\\W]*'), "gi");
                clean = clean.replace(regex, "[REDACTED]");
            });
            
            // Enforce length limit
            return clean.trim().substring(0, 150);
        };

        window.updateCharCount = function(textarea) {
            const remaining = 150 - textarea.value.length;
            const counter = document.getElementById('char-count');
            counter.innerText = remaining;
            counter.style.color = remaining < 20 ? '#ff0000' : '#00ff00';
        };

        window.loadVoodooMessages = function() {
            const feed = document.getElementById('voodoo-feed');
            
            // Don't wipe the feed if it already has content, to prevent flickering
            if(feed.children.length === 0 || feed.innerText.includes('SYSTEM:')) {
                 feed.innerHTML = 'SYSTEM: ACCESSING VOODOO STREAM...';
            }

            const cacheBuster = SCRIPT_URL + (SCRIPT_URL.includes('?') ? '&' : '?') + 't=' + new Date().getTime();
            fetch(cacheBuster, { method: "GET", redirect: "follow" })
            .then(res => {
                if (!res.ok) throw new Error('Network response not ok');
                return res.json();
            })
            .then(data => {
                // Clear and rebuild
                feed.innerHTML = '';
                if (data && Array.isArray(data)) {
                    data.reverse().forEach(row => {
                        const entry = document.createElement('div');
                        entry.style.marginBottom = "15px";
                        entry.style.borderBottom = "1px solid #222";
                        entry.style.paddingBottom = "8px";
                        const displayName = window.sanitize(row[1] || 'Unknown Designation');
                        const displayMsg = window.sanitize(row[2] || 'Empty Transmission');
                        entry.innerHTML = `<span style="color: #ffcc00; font-size: 0.9em; font-weight: bold;">[${displayName}]</span><br>${displayMsg}`;
                        feed.appendChild(entry);
                    });
                    if (data.length === 0) feed.innerHTML = 'SYSTEM: NO TRANSMISSIONS FOUND.';
                }
            })
            .catch(err => {
                console.error("Voodoo Load Error:", err);
                // Only show error if feed is empty
                if(feed.children.length === 0) {
                    feed.innerHTML = 'SYSTEM ERROR: CONNECTION INTERRUPTED.<br><br>Check browser console or verify Google Script deployment.';
                }
            });
        };

        window.postToVoodoo = function() {
            const nameField = document.getElementById('voodoo-name');
            const msgField = document.getElementById('voodoo-msg');
            const name = window.sanitize(nameField.value) || 'Anonymous';
            const message = window.sanitize(msgField.value);
            if (!message) return;
            const btn = document.querySelector('button[onclick="window.postToVoodoo()"]');
            const originalText = btn.innerText;
            btn.innerText = "[ TRANSMITTING... ]";
            btn.disabled = true;

            // Save name to LocalStorage
            if (nameField.value.trim()) {
                localStorage.setItem('crawlerName', nameField.value.trim());
            }

            const formData = new URLSearchParams();
            formData.append('name', name);
            formData.append('message', message);
            fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors', 
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: formData.toString()
            })
            .then(() => {
                msgField.value = '';
                // Reset char count
                document.getElementById('char-count').innerText = '150';
                btn.innerText = "[ BROADCAST SUCCESS ]";
                setTimeout(window.loadVoodooMessages, 2000);
                setTimeout(() => { 
                    btn.innerText = originalText; 
                    btn.disabled = false;
                }, 4000);
            })
            .catch(err => {
                console.error("Voodoo Post Error:", err);
                btn.innerText = "[ TRANSMISSION FAILED ]";
                btn.disabled = false;
                setTimeout(() => { btn.innerText = originalText; }, 3000);
            });
        };
    </script>
</body>
</html>
