<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dungeon World Chat - Sector 404</title>
    <style>
        /* Base Styles & Mobile-First Design */
        body {
            background-color: #050505;
            color: #f0f0f0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            padding: 10px;
            max-width: 850px;
            margin: auto;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        /* Achievement Box & Glitch Effect */
        .system-ai {
            background: linear-gradient(180deg, #990000 0%, #300000 100%);
            border: 4px solid #ff4500;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 0 30px #ff4500;
            transition: all 0.2s ease;
        }

        .glitch { animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        .header {
            color: #ffcc00;
            font-weight: bold;
            font-size: 1.8em;
            text-transform: uppercase;
            text-shadow: 2px 2px #000;
            line-height: 1.1;
        }

        /* Rarity Classes */
        .rarity-common { border-color: #888; box-shadow: 0 0 15px #888; }
        .rarity-legendary { border-color: #ff8c00; box-shadow: 0 0 25px #ff8c00; }
        .rarity-celestial { border-color: #00ffff; box-shadow: 0 0 30px #00ffff; }

        .achievement {
            color: #fff;
            font-size: 1.3em;
            font-weight: bold;
            margin: 10px 0;
            border-bottom: 2px solid #ff4500;
            padding-bottom: 5px;
        }
        .ai-snark { color: #ffa500; font-style: italic; font-weight: bold; font-size: 1em; line-height: 1.4; }

        /* Chat UI */
        .chat-window { border: 2px solid #444; background: rgba(20, 20, 20, 0.95); padding: 12px; }
        .chat-entry { margin-bottom: 18px; padding: 15px; border-radius: 6px; font-size: 0.95em; line-height: 1.5; }

        .donut { border-left: 6px solid #ff69b4; background: #2b121e; }
        .mordecai { border-left: 6px solid #00d4ff; background: #121c2b; }
        .quasar { border-left: 6px solid #ffcc00; background: #2b2512; }
        .casandra { border-left: 6px solid #00ff00; background: #122b1a; }
        .prepotente { border-left: 6px solid #fdfd96; background: #2b2b12; }
        .katia { border-left: 6px solid #00ffff; background: #122b2b; }

        .username { font-weight: bold; display: block; margin-bottom: 5px; text-transform: uppercase; font-size: 0.8em; }
        .donut .username { color: #ff69b4; }
        .mordecai .username { color: #00d4ff; }
        .quasar .username { color: #ffcc00; }
        .casandra .username { color: #00ff00; }
        .prepotente .username { color: #fdfd96; }
        .katia .username { color: #00ffff; }

        /* Floor Status */
        .floor-status { margin-top: 25px; padding: 15px; border-left: 6px solid #ffcc00; background: #221e00; font-size: 0.85em; }
        .status-header { color: #ffcc00; font-weight: bold; display: block; margin-bottom: 10px; text-transform: uppercase; }
        .status-list { list-style: none; padding: 0; margin: 0; }
        .status-list li { margin-bottom: 5px; }

        /* Footer & Buttons */
        .node-footer { margin-top: 25px; border: 2px solid #00ff00; padding: 20px; text-align: center; background: #000; }
        .button {
            display: block; width: 100%; box-sizing: border-box; margin-top: 15px; padding: 16px;
            background-color: #00ff00; color: #000; font-weight: bold; text-decoration: none;
            text-transform: uppercase; font-size: 1.1em; border-radius: 4px; border: none; cursor: pointer;
            transition: opacity 0.2s;
        }
        .button:active { opacity: 0.7; }

        /* Share Options Styles */
        #share-options { display: none; margin-top: 15px; }
        .share-grid { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
        .share-btn { margin: 0 !important; flex: 1; min-width: 80px; padding: 12px !important; font-size: 0.9em !important; color: white !important; }

        @media (min-width: 600px) {
            body { padding: 30px; }
            .header { font-size: 2.2em; }
            .achievement { font-size: 1.6em; }
            .button { width: auto; display: inline-block; padding: 15px 40px; }
        }
    </style>
</head>
<body>

    <div class="system-ai">
        <div class="header">!!! NEW ACHIEVEMENT !!!</div>
        <div class="achievement">"CON-FLOOR SURVIVOR"</div>
        <p>YOU DID IT! Youâ€™ve successfully navigated the <strong>ATLANTA SKYBRIDGE GAUNTLET</strong>! You have survived the humidity, the smell of burnt rubber and expensive polyester, and the sheer, unadulterated chaos of sixty-thousand humans trying to occupy the same square inch of hotel carpet! IT IS A MIRACLE YOU HAVEN'T BEEN CRUSHED!</p>
        <p class="ai-snark">REWARD: Youâ€™ve received a [Platinum] Badge Ribbon! It grants you +5 to Crowd Maneuvering and -10 to Personal Space. Also, Carl, look at the feet on these people! WHY DO YOU DO THIS TO ME?! GET BACK TO THE MESH!</p>
    </div>

    <div class="chat-window">
        <div class="chat-entry donut">
            <span class="username">Princess Donut Lvl 50 Queen Anne Chonk</span>
            CARL! MONGO IS APPALLED! WHY ARE ALL THESE PEOPLE LOOKING AT A MAN IN A SPANDEX ONESIE? TELL THE NETWORK ADMIN TO BROADCAST MY IMAGE ON EVERY SCREEN IN THE HYATT IMMEDIATELY!
        </div>

        <div class="chat-entry prepotente">
            <span class="username">Prepotente (Pony Extraordinaire)</span>
            AAAAAAAAAAHHHHHH! MOTHER! THE ELEVATORS ARE A BORANT CONSPIRACY! THEY WANT US TO STARVE ON THE SKYBRIDGE! AAAAAAAAAAHHHHHHH!
        </div>

        <div class="chat-entry katia">
            <span class="username">Katia (Level 42 Tank)</span>
            Carl, Iâ€™ve found a path through the food court, but itâ€™s guarded by a Level 60 'Line for Pizza.' We need to use this mesh node to coordinate the bypass!
        </div>

        <div class="chat-entry mordecai">
            <span class="username">Mordecai (Manager)</span>
            Stop screaming! Prepotente, the elevators have been broken since the tenth floor. Crawler, keep that signal steady! We need a clear link before the Skybridge becomes a total chokepoint.
        </div>

        <div class="chat-entry quasar">
            <span class="username">Quasar (Legal Counsel/Certified Genius)</span>
            CHOKEPOINT? Iâ€™ll sue the very concept of occupancy! Iâ€™ll sue the bricks! CRAWLER, YOUR RIGHT TO STAND IN THIS CROWDED HALLWAY IS CONSTITUTIONALLY PROTECTED BY ME!
        </div>

        <div class="chat-entry casandra">
            <span class="username">Casandra (Exasperated Operations)</span>
            EVERYONE SHUT UP! Crawler, keep the mesh open. If I lose my tactical overview because you were too busy looking at cosplayers, I will personally rewrite your respawn protocol!
        </div>
    </div>

    <div class="floor-status">
        <span class="status-header">[ LIVE FLOOR STATUS: SECTOR ATLANTA ]</span>
        <ul class="status-list">
            <li>ðŸ”¸ ELEVATORS: [CRITICAL FAILURE] - USE STAIRS</li>
            <li>ðŸ”¸ HUMIDITY: 98% [SWAMP CONDITIONS]</li>
            <li>ðŸ”¸ HYDRATION: [WARNING] - PIZZA IS NOT A REPLACEMENT FOR WATER</li>
            <li>ðŸ”¸ CARPET: [MEMETIC HAZARD] - DO NOT STARE AT PATTERN</li>
            <li>ðŸ”¸ MESH STATUS: [OPTIMAL] - NODE !1fcff30a ACTIVE</li>
        </ul>
    </div>

    <div class="node-footer">
        <strong style="color: #00ff00;">[ DRAGON CON MESH ACTIVE ]</strong><br>
        <span style="color: #888;">NODE ID: !1fcff30a</span><br>
        <a href="https://meshtastic.org/v/#CIrmv_4BElAKCSExZmNmZjMwYRIPb2JpLXdhbi1rZW1lc2hpGgRmMzBhIgbFMx_P8wooWEIgx5cjLfBcMK-Y-ZG_cuCi_jPojvkJoYq-P1lXSvX0YHxIAA" class="button">JOIN THE MESH</a>
    </div>

    <div id="gen-container" class="system-ai" style="margin-top: 30px; border-style: dashed; background: #220000;">
        <div id="custom-header" class="header" style="font-size: 1.4em;">SYSTEM READY...</div>
        <div id="custom-title" class="achievement">"TAP FOR FATE"</div>
        <p id="custom-body" style="font-size: 0.9em;">Generate a useless achievement based on your level of survival.</p>
        <button onclick="generateAchievement()" class="button" style="background-color: #ff4500; color: white;">GENERATE ACHIEVEMENT</button>

        <div id="share-options">
            <p style="font-size: 0.8em; color: #ffcc00; margin-bottom: 10px;">BRAG TO THE FEED:</p>
            <div class="share-grid">
                <button class="button share-btn" onclick="shareX()" style="background: #000;">X</button>
                <button class="button share-btn" onclick="shareBlueSky()" style="background: #0085ff;">BlueSky</button>
                <button class="button share-btn" onclick="shareThreads()" style="background: #444;">Threads</button>
                <button class="button share-btn" onclick="copyToClipboard(event)" style="background: #00ff00; color: #000;">Copy</button>
            </div>
        </div>
    </div>

    <div class="chat-window" style="margin-top: 25px; border-color: #00ff00; margin-bottom: 50px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <span class="username" style="color: #00ff00; margin: 0;">[ VOODOO BOARD: SECTOR ATLANTA ]</span>
            <button onclick="loadVoodooMessages()" style="background: none; border: 1px solid #00ff00; color: #00ff00; font-size: 0.7em; padding: 2px 8px; cursor: pointer;">REFRESH</button>
        </div>
        
        <div id="voodoo-feed" style="height: 250px; overflow-y: auto; background: #000; padding: 10px; font-family: monospace; font-size: 0.85em; border: 1px solid #333; margin-bottom: 15px; color: #00ff00;">
            SYSTEM: INITIALIZING VOODOO FEED...
        </div>

        <div style="display: flex; flex-direction: column; gap: 8px;">
            <input type="text" id="voodoo-name" placeholder="[ CRAWLER DESIGNATION ]" style="background: #111; border: 1px solid #00ff00; color: #00ff00; padding: 10px; font-family: monospace; width: 100%; box-sizing: border-box;">
            <textarea id="voodoo-msg" placeholder="[ UNENCRYPTED BURST TRANSMISSION ]" style="background: #111; border: 1px solid #00ff00; color: #00ff00; padding: 10px; font-family: monospace; height: 60px; width: 100%; box-sizing: border-box; resize: none;"></textarea>
            <button onclick="postToVoodoo()" class="button" style="margin: 0; padding: 12px; font-size: 0.9em;">[ BROADCAST TO SECTOR ]</button>
        </div>
    </div>

    <script>
        // Use window explicitly to avoid scope issues in blob/restricted environments
        window.currentTitle = "";
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx7ljyRllZ4a0OYp3B7Nrfw3Bn3QUMsXrUtJ44RlnDUk9fL8I0AyeocNrw1jXLbnDK6wg/exec';

        window.onload = function() {
            setTimeout(function() {
                window.loadVoodooMessages();
            }, 500);
        };

        window.generateAchievement = function() {
            const adjectives = ["Legendary", "Decrepit", "Glistening", "Appalled", "Celestial", "Malfunctioning", "Stinky", "Exasperated", "Unhinged", "Copyright-Infringing", "God-Tier", "Sticky", "Slime-Covered", "Aggressive"];
            const nouns = ["Skybridge", "Tiara", "Oats", "Packet", "Llama", "Cosplayer", "Holocron", "Badge", "Elevator", "Con-Crud", "Foot-Photo", "Vendor-Hall", "Service-Lift"];
            const verbsPast = ["wrangled", "evaded", "glurped", "sued", "screamed at", "infiltrated", "buffered", "ignored", "acquired", "over-clocked", "petted", "dismantled"];
            const verbsIng = ["wrangling", "evading", "glurping", "suing", "screaming at", "infiltrating", "buffering", "ignoring", "acquiring", "over-clocking", "petting", "dismantling"];

            const pick = (arr) => arr[Math.floor(Math.random() * arr.length)];
            const roll = Math.floor(Math.random() * verbsPast.length);

            const adj = pick(adjectives);
            const noun = pick(nouns);
            const vPast = verbsPast[roll];
            const vIng = verbsIng[roll];

            const article = /^[aeiou]/i.test(adj) ? "an" : "a";
            const isPlural = ["Oats"].includes(noun);
            const fullNoun = isPlural ? `${adj} ${noun}` : `${article} ${adj} ${noun}`;

            const bodies = [
                `You have ${vPast} ${fullNoun} in a way that makes the AI very uncomfortable.`,
                `Against all odds, you successfully ${vPast} ${fullNoun} without causing a sector-wide reset.`,
                `By ${vIng} ${fullNoun}, you have officially peaked. It's all downhill from here.`,
                `The AI noticed you ${vPast} ${fullNoun}. It's currently writing a creepy poem about it.`,
                `You just ${vPast} ${fullNoun}. Mordecai is sighing so hard he might pass out.`
            ];

            let reward = "A Common Quality Cotton Sock.";
            if (noun === "Tiara") reward = "Princess Donut's grudging respect.";
            else if (noun === "Oats") reward = "10 seconds of silence from Prepotente.";
            else if (noun === "Foot-Photo") reward = "A [God-Tier] digital framing kit.";
            else reward = pick(["Priority Elevator Access (Still Broken).", "A Signed Photo of Mongo.", "+5 to Humidity Resistance.", "A commemorative pin that says 'I Tried'."]);

            const container = document.getElementById('gen-container');
            container.classList.remove('glitch', 'rarity-common', 'rarity-legendary', 'rarity-celestial');
            void container.offsetWidth; 
            container.classList.add('glitch');

            const rarity = pick(["rarity-common", "rarity-legendary", "rarity-celestial"]);
            container.classList.add(rarity);

            window.currentTitle = `${adj} ${noun}`;
            document.getElementById('custom-header').innerText = "NEW ACHIEVEMENT!";
            document.getElementById('custom-title').innerText = `"${window.currentTitle}"`;
            document.getElementById('custom-body').innerText = `${pick(bodies)}\n\nREWARD: ${reward}`;
            document.getElementById('share-options').style.display = 'block';
        };

        window.getShareText = function() {
            return `I just earned the "${window.currentTitle}" achievement at Dragon Con! Don't tell Mordecai: hbar98.github.io #DragonCon #DCC`;
        };

        window.shareX = function() { window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(window.getShareText())}`, '_blank'); };
        window.shareBlueSky = function() { window.open(`https://bsky.app/intent/compose?text=${encodeURIComponent(window.getShareText())}`, '_blank'); };
        window.shareThreads = function() { window.open(`https://www.threads.net/intent/post?text=${encodeURIComponent(window.getShareText())}`, '_blank'); };

        window.copyToClipboard = function(e) {
            if (!navigator.clipboard) {
                const textArea = document.createElement("textarea");
                textArea.value = window.getShareText();
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    const btn = e.target;
                    const originalText = btn.innerText;
                    btn.innerText = "COPIED!";
                    setTimeout(() => { btn.innerText = originalText; }, 2000);
                } catch (err) {}
                document.body.removeChild(textArea);
                return;
            }
            navigator.clipboard.writeText(window.getShareText()).then(() => {
                const btn = e.target;
                const originalText = btn.innerText;
                btn.innerText = "COPIED!";
                setTimeout(() => { btn.innerText = originalText; }, 2000);
            });
        };

        window.loadVoodooMessages = function() {
            const feed = document.getElementById('voodoo-feed');
            feed.innerHTML = 'SYSTEM: ACCESSING VOODOO STREAM...';

            fetch(SCRIPT_URL, { 
                method: "GET",
                mode: "cors",
                cache: "no-store",
                credentials: "omit",
                redirect: "follow"
            })
            .then(res => {
                if (!res.ok) throw new Error('Network response was not ok');
                return res.json();
            })
            .then(data => {
                feed.innerHTML = '';
                if (data && Array.isArray(data)) {
                    data.reverse().forEach(row => {
                        const entry = document.createElement('div');
                        entry.style.marginBottom = "10px";
                        entry.style.borderBottom = "1px solid #1a1a1a";
                        entry.style.paddingBottom = "5px";
                        entry.innerHTML = `<span style="color: #888; font-size: 0.8em;">[${row[1] || 'Unknown'}]</span><br>${row[2]}`;
                        feed.appendChild(entry);
                    });
                    if (data.length === 0) {
                        feed.innerHTML = 'SYSTEM: NO TRANSMISSIONS FOUND.';
                    }
                }
            })
            .catch(err => {
                console.error("Voodoo Load Error:", err);
                feed.innerHTML = 'SYSTEM ERROR: CONNECTION INTERRUPTED.<br><br>Ensure the Google Script is deployed for "Anyone" and redirected to follow.';
            });
        };

        window.postToVoodoo = function() {
            const nameField = document.getElementById('voodoo-name');
            const msgField = document.getElementById('voodoo-msg');
            const name = nameField.value.trim() || 'Anonymous';
            const message = msgField.value.trim();

            if (!message) return;

            const btn = document.querySelector('button[onclick="postToVoodoo()"]');
            btn.innerText = "[ TRANSMITTING... ]";
            btn.disabled = true;

            const formData = new URLSearchParams();
            formData.append('name', name);
            formData.append('message', message);

            fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: formData.toString()
            })
            .then(() => {
                msgField.value = '';
                btn.innerText = "[ BROADCAST SUCCESS ]";
                setTimeout(window.loadVoodooMessages, 2000);
                setTimeout(() => { 
                    btn.innerText = "[ BROADCAST TO SECTOR ]"; 
                    btn.disabled = false;
                }, 4000);
            })
            .catch(err => {
                console.error("Voodoo Post Error:", err);
                btn.innerText = "[ TRANSMISSION FAILED ]";
                btn.disabled = false;
                setTimeout(() => { btn.innerText = "[ BROADCAST TO SECTOR ]"; }, 3000);
            });
        };
    </script>
</body>
</html>
